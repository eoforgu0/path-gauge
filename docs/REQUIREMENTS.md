# 要件定義書: PathGauge

## 概要

任意のマップ画像上にクリックでパス（経路）を描き、そのパスの長さ（ピクセル距離）を表示・比較するWebツール。

## デプロイ・技術スタック

詳細は `TECH_STACK.md` を参照。

| 項目 | 内容 |
|------|------|
| フレームワーク | React 19 + TypeScript 5.9 |
| ビルドツール | Vite 7 |
| スタイリング | Tailwind CSS 4 |
| Canvas描画 | Konva + react-konva |
| 状態管理 | Zustand 5 |
| リンター/フォーマッター | Biome 2.x |
| デプロイ先 | GitHub Pages（GitHub Actions で自動デプロイ） |
| 対応デバイス | デスクトップブラウザ優先。モバイルでもレイアウトが崩れない程度のレスポンシブ対応 |

## 想定利用規模

- パス1本あたりのノード数: 数点〜10点程度
- 同時比較パス数: 2〜3本

## 機能一覧

### P0: コア機能（必須）

#### F1. 画像の読み込み
- ドラッグ＆ドロップによる画像読み込み
- ファイル選択ダイアログによる画像読み込み
- テンプレート画像の選択（リポジトリに同梱する画像をプリセットとして選べる）
  - テンプレート画像はユーザーが自分で用意し `public/templates/` 等に配置する想定
  - テンプレート一覧はサムネイル付きで表示
  - テンプレートには単位変換のプリセット（倍率・単位表記）を含められる

#### F2. パスの描画
- 画像上をクリックして点（ノード）を打つ
- ノード同士を直線で結びパスを形成する
- パスの描画中、最後に打ったノードからマウスカーソルまでプレビュー線を表示
- ダブルクリックまたは確定ボタンでパスの描画を完了

#### F3. 複数パスの管理
- 複数のパスを同時に画像上に表示
- パスごとに自動で色を割り当て（カラーパレットから順に割当）
- パスの色を手動で変更可能
- パスに名前（ラベル）を付けられる（デフォルト名: Path 1, Path 2, ...）
- パスリストをサイドパネルに一覧表示

#### F4. 距離の表示
- 各パスの合計距離を表示
- パスリスト内に距離を常時表示し、比較しやすくする
- 各エッジ（線分）の距離をキャンバス上のエッジ中点付近に小さく表示する

#### F5. 単位変換
- ユーザーが「倍率」と「単位表記」を自由に設定できる（例: 1px = 0.5 → 単位表記「m」）
- 単位設定時は変換後の値のみ表示（ピクセル値の併記は不要）
- 未設定時はピクセル（px）表示
- テンプレート画像にはこの設定をプリセットできる

### P1: 操作性向上（必須）

#### F6. Undo
- 描画中のパスについて、最後に打った1ノードを取り消す（Ctrl+Z / ⌘+Z 対応）

#### F7. パスのクリア
- 全パスを一括削除するボタン
- 個別パスの削除ボタン

#### F8. 画像のズーム・パン
- マウスホイールでズームイン/ズームアウト
- ドラッグ（中ボタンまたはモード切替）でパン
- ズーム状態でもパスの描画・表示が正しく動作すること
- ズームリセットボタン（Fit to screen）

#### F9. スナップ機能
- **新規ノード配置時**: Shift押しながらクリックで、直前のノードに対して水平/垂直にスナップ
- **ノードドラッグ時**: Shift押しながらドラッグで、前後のノードに対して水平/垂直にスナップ
- スナップ方式: マウスカーソルは自由に動く。スナップ済みの位置にゴースト（仮表示ポインター）を表示し、実際のノード配置/移動はゴーストの座標を使用する
- スナップ時はガイドライン（水平/垂直の点線）を表示

#### F10. ノードの編集
- 既存パスのノードをドラッグで移動
- ドラッグ中に距離がリアルタイムで更新される
- パスの線の上をクリックして途中にノードを挿入
- ノードの削除

### P2: あると嬉しい機能（将来拡張）

#### F11. パスのエクスポート
- パスデータ（座標・距離）をJSONで書き出し
- 画像+パスをPNG画像として書き出し

## UI構成（参考レイアウト）

詳細は `UI_DESIGN.md` を参照。

```
┌─────────────────────────────────────────────────┐
│ ツールバー                                         │
│ [画像読込] [新規パス] [Undo] [全クリア] [ズームリセット]  │
├──────────────────────────────────┬──────────────┤
│                                  │ パスリスト      │
│                                  │              │
│         画像キャンバス              │ Path 1  320m │
│        （ズーム・パン対応）          │ Path 2  580m │
│                                  │ Path 3  210m │
│                                  │              │
│                                  │ [新規パス]     │
│                                  │              │
│                                  │ 単位設定       │
├──────────────────────────────────┴──────────────┤
│ ステータスバー: カーソル座標 (x, y) │ ズーム 100%    │
└─────────────────────────────────────────────────┘
```

## 操作フロー

1. 画像を読み込む（D&D / ファイル選択 / テンプレート選択）
2. （任意）単位を設定する
3. 「新規パス」ボタンを押す → 描画モードに入る
4. 画像上をクリックしてノードを打つ → 直線で結ばれていく
   - Shift押しながらで水平/垂直スナップ
5. ダブルクリックまたは「確定」で描画完了 → パスリストに追加される
6. 必要に応じてパスの名前・色を変更
7. 必要に応じてノードをドラッグで微調整
8. 別のパスを追加して距離を比較

## 非機能要件

- パフォーマンス: 4000×4000px程度の画像でもスムーズに動作
- 状態管理: ブラウザのみで動作（サーバー不要、localStorageも不要）
- アクセシビリティ: キーボードショートカット対応（Undo: Ctrl+Z、削除: Delete）

## テンプレート画像の管理方針

テンプレート画像はリポジトリの `public/templates/` ディレクトリに配置する。
設定ファイル（`public/templates/manifest.json`）にファイル名・表示名・単位プリセットを記載し、アプリ側で読み取る。

```json
{
  "templates": [
    {
      "file": "world-map.png",
      "name": "世界地図",
      "unit": {
        "scale": 2.5,
        "label": "km"
      }
    },
    {
      "file": "floor-plan.png",
      "name": "間取り図",
      "unit": {
        "scale": 0.01,
        "label": "m"
      }
    },
    {
      "file": "sample.png",
      "name": "サンプル画像"
    }
  ]
}
```

`unit` フィールドは省略可能。省略時はピクセル表示。

## GitHub Pages デプロイ

- `vite.config.ts` で `base` をリポジトリ名に設定
- GitHub Actions で `main` ブランチ push 時に自動ビルド＆デプロイ
- デプロイ用ワークフロー（`.github/workflows/deploy.yml`）を同梱

# UIデザイン仕様

---

## 1. 全体レイアウト

### 1.1 画面構成

```
┌─────────────────────────────────────────────────────────────┐
│  ツールバー（固定）                                   高さ 48px │
│  [画像読込] [新規パス] [確定] [Undo] [全クリア] [ズームリセット]   │
├────────────────────────────────────────┬────────────────────┤
│                                        │ 右サイドパネル       │
│                                        │ 固定幅 280px        │
│                                        │ 折りたたみ可能       │
│                                        │                    │
│         画像キャンバス                    │ ┌─ パスリスト ────┐ │
│        （残り幅を占有 flex-1）            │ │ Path 1   320m  │ │
│                                        │ │ Path 2   580m  │ │
│                                        │ │ Path 3   210m  │ │
│                                        │ │ [+ 新規パス]    │ │
│                                        │ └────────────────┘ │
│                                        │ ┌─ 単位設定 ─────┐ │
│                                        │ │ 倍率: [   0.5] │ │
│                                        │ │ 単位: [     m] │ │
│                                        │ └────────────────┘ │
├────────────────────────────────────────┴────────────────────┤
│  ステータスバー（折りたたみ可能）                      高さ 28px │
│  カーソル: (1234, 567)                      ズーム: 150%     │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 レイアウト方針

- **ツールバー**: 上部固定。高さ 48px
- **キャンバス**: 残り幅を占有（flex-1）。背景は `#1a1a2e`（ダーク）
- **右サイドパネル**: 固定幅 280px。折りたたみ時はトグルボタン（幅 24px 程度）のみ残る
- **ステータスバー**: 下部固定。高さ 28px。折りたたみ可能（デフォルト表示）
- 全体は `100vh` で、スクロールなし（キャンバスのみ内部でズーム/パン）

### 1.3 画像未読み込み時

キャンバス領域全体が画像読み込みUIになる。

```
┌──────────────────────────────────────┐
│                                      │
│          ┌──────────────────┐        │
│          │  📁               │        │
│          │                  │        │
│          │  画像をドラッグ＆   │        │
│          │  ドロップ          │        │
│          │  または           │        │
│          │  [ファイルを選択]   │        │
│          │                  │        │
│          │  ── テンプレート ── │        │
│          │  [世界地図] [間取] │        │
│          └──────────────────┘        │
│                                      │
└──────────────────────────────────────┘
```

- 中央にドロップゾーン（破線ボーダー）
- ファイル選択ボタン
- テンプレート画像はサムネイル付きで横並び表示
- 画像読み込み後はこのUIが消え、キャンバスに切り替わる

---

## 2. 配色

### 2.1 カラーパレット（ダークモード）

```css
@theme {
  /* ベース */
  --color-bg: #0f1117;            /* 全体背景 */
  --color-surface: #1a1b2e;       /* パネル背景 */
  --color-surface-hover: #252640; /* ホバー時 */
  --color-border: #2a2b3d;        /* 境界線 */
  --color-text: #e2e8f0;          /* 本文 slate-200 */
  --color-text-muted: #94a3b8;    /* 補助テキスト slate-400 */
  --color-text-dim: #64748b;      /* さらに薄いテキスト slate-500 */

  /* キャンバス */
  --color-canvas-bg: #1a1a2e;     /* キャンバス背景 */

  /* アクセント */
  --color-accent: #6366f1;        /* プライマリ indigo-500 */
  --color-accent-hover: #818cf8;  /* プライマリホバー indigo-400 */

  /* パスカラーパレット（自動割当順） */
  --color-path-1: #ef4444;        /* red-500 */
  --color-path-2: #3b82f6;        /* blue-500 */
  --color-path-3: #22c55e;        /* green-500 */
  --color-path-4: #f59e0b;        /* amber-500 */
  --color-path-5: #8b5cf6;        /* violet-500 */
  --color-path-6: #ec4899;        /* pink-500 */
  --color-path-7: #06b6d4;        /* cyan-500 */
  --color-path-8: #84cc16;        /* lime-500 */

  /* スナップ */
  --color-snap-guide: #6366f1;    /* スナップガイドライン indigo-500 */
  --color-snap-ghost: #6366f180;  /* ゴーストノード（半透明） */

  /* 状態 */
  --color-danger: #ef4444;        /* 削除系 red-500 */
  --color-danger-hover: #dc2626;  /* 削除ホバー red-600 */
}
```

---

## 3. Canvas上の描画仕様

### 3.1 ノード（点）

| 状態 | 半径 | 塗り | ストローク | ストローク幅 |
|------|------|------|-----------|------------|
| 通常 | 6px | パスの色 | 白 (#ffffff) | 2px |
| ホバー | 8px | パスの色（明度+20%） | 白 | 2px |
| ドラッグ中 | 8px | パスの色 | 白 | 3px |
| 描画中の最新ノード | 7px | パスの色 | 白 | 2px |

- ノードはズームレベルに関わらず画面上のサイズを一定に保つ（`1 / scale` で補正）

### 3.2 エッジ（線）

| 状態 | 太さ | 色 | スタイル |
|------|------|-----|---------|
| 通常 | 3px | パスの色 | 実線 |
| ホバー（挿入可能） | 4px | パスの色（明度+20%） | 実線 |
| 描画中のプレビュー線 | 2px | パスの色（50%透過） | 破線 |

- `hitStrokeWidth`: 20px（線上クリック検出用の当たり判定）
- エッジもズームレベルで画面上の太さを一定に保つ

### 3.3 エッジ距離ラベル

各エッジ（線分）の中点付近に、そのエッジの距離を小さく表示する。

| 項目 | 値 |
|------|-----|
| フォントサイズ | 11px（画面上固定、ズーム補正） |
| フォント色 | パスの色 |
| 背景 | `#0f1117cc`（半透明ダーク） |
| 背景パディング | 2px 4px |
| 位置 | エッジの中点、線分からわずかにオフセット（法線方向に 12px） |
| 表示内容 | 距離値 + 単位（例: `142.3m`、未設定時 `142px`） |

- ズームが引きすぎてラベルが重なる場合は非表示にする（閾値は実装時に調整）

### 3.4 スナップガイドライン

| 項目 | 値 |
|------|-----|
| 太さ | 1px（画面上固定） |
| 色 | `--color-snap-guide`（indigo-500） |
| スタイル | 破線（dash: [6, 4]） |
| 範囲 | 基準ノードからゴーストノードまで（無限には伸ばさない） |

### 3.5 スナップゴースト

| 項目 | 値 |
|------|-----|
| 半径 | 6px（通常ノードと同サイズ） |
| 塗り | `--color-snap-ghost`（パスの色 50%透過） |
| ストローク | なし |

---

## 4. ツールバー

### 4.1 ボタン配置

```
[画像読込] [新規パス] [確定] | [Undo] [全クリア] | [ズームリセット] | [パネル折りたたみ]
```

- 機能グループごとにセパレータ（`|`）で区切る
- アイコン + テキストラベル（幅に余裕がなければアイコンのみ + ツールチップ）

### 4.2 ボタン状態

| ボタン | 通常時 | 無効時 |
|--------|--------|--------|
| 画像読込 | 常に有効 | — |
| 新規パス | 画像読込済み & 描画中でないとき有効 | 画像未読込 or 描画中 |
| 確定 | 描画中（2ノード以上）のとき有効 | 描画中でない or 1ノード以下 |
| Undo | 描画中（1ノード以上）のとき有効 | 描画中でない or 0ノード |
| 全クリア | パスが1本以上あるとき有効 | パスなし |
| ズームリセット | 画像読込済みのとき有効 | 画像未読込 |

---

## 5. 右サイドパネル

### 5.1 パスリスト

各パスは以下の情報を表示するカード形式:

```
┌──────────────────────────────┐
│ ● Path 1              320.5m │
│   [名前変更] [色変更] [削除]   │
└──────────────────────────────┘
```

- `●` はパスの色（カラーインジケータ）
- パス名はインラインで編集可能
- 距離は右寄せ
- 色変更はカラーインジケータのクリックでカラーピッカーを表示
- 削除は控えめなアイコンボタン
- アクティブなパス（選択中/描画中）はボーダーや背景色で強調
- パスリスト下部に「+ 新規パス」ボタン

### 5.2 単位設定セクション

パスリストの下に配置。

```
┌── 単位設定 ──────────────────┐
│ 倍率  [        0.5 ]        │
│ 単位  [          m ]        │
└──────────────────────────────┘
```

- 倍率: 数値入力（1px あたりの実距離値）
- 単位: テキスト入力（自由記述。例: m, km, ft）
- テンプレート画像読み込み時、プリセット値が自動入力される
- 倍率が空または0のときはピクセル表示にフォールバック

### 5.3 折りたたみ

- 折りたたみ時: サイドパネルが非表示になり、右端に展開トグルボタン（`◀` アイコン）のみ残る
- 展開時: トグルボタンが `▶` に変わる
- ツールバー右端の折りたたみボタンでも操作可能

---

## 6. ステータスバー

### 6.1 表示内容

```
カーソル: (1234, 567)                                    ズーム: 150%
```

- 左側: マウスカーソルの画像上座標（ピクセル座標）
- 右側: 現在のズーム率（%表示）
- 折りたたみ時: 完全に非表示（高さ0）

---

## 7. キーボードショートカット

| キー | 動作 | 条件 |
|------|------|------|
| Ctrl+Z / ⌘+Z | Undo（1ノード戻る） | 描画中 |
| Delete / Backspace | 選択中のノードを削除 | ノード選択中 |
| Escape | 描画をキャンセル | 描画中 |
| Shift（押しながら） | スナップ有効化 | ノード配置/ドラッグ中 |

---

## 8. カーソル

| 状態 | カーソル |
|------|---------|
| 通常（キャンバス上） | default |
| 描画モード中 | crosshair |
| ノードホバー | grab |
| ノードドラッグ中 | grabbing |
| エッジホバー（挿入可能） | copy（+マーク） |
| パン操作中 | move |

# チケット管理

## 運用ルール

- 1チケット = 1ファイル（`XXX_短い説明.md`）
- 番号は3桁ゼロ埋め
- 対応完了後、ファイル名の先頭に `DONE_` を付けてリネーム（例: `DONE_001_project_setup.md`）
- 各チケットの「完了条件」をすべて満たしたら完了とする
- 他チケットに統合された場合、`MERGED_INTO_XXX_` プレフィックスが付く（対応不要）

## コミット手順

チケット完了時は以下の順序でコミットすること:

1. コードの変更を完了する
2. チケットファイルをリネーム（`DONE_` プレフィックスを付ける）
3. 今回のチケットで追加・変更・削除したファイルとリネーム後のチケットファイルを個別に `git add` する
4. `git commit -m "ticket-XXX: 短い説明"`

**重要**:
- `git add .` は使わないこと。他の作業者の未コミット変更を巻き込む可能性がある。必ずファイルを個別指定すること。
- リネームの前に `git add` しないこと。リネーム前のファイル削除だけが検出される不正な状態になる。必ず「リネームしてから `git add`」の順序を守ること。

## 対応手順

1. `tickets/` 内の未完了チケット（`DONE_` も `MERGED_INTO_` も付いていないもの）を番号順に確認
2. チケット内で参照されている設計書（`docs/` 配下）を必ず読んでから作業すること
3. 1チケットずつ対応し、完了条件を満たしたら上記コミット手順に従いコミット

## 番号体系

- 001〜: 機能実装・環境構築（構築フェーズ）
- 構築完了後、バグ修正や改善チケットも同じ連番で追加する

## コード品質ルール

チケット対応時は以下を常に意識すること。

### 既存コードの尊重
- 新規コードを書く前に、関連する既存ファイルを読み、命名規則・構造・パターンを掴んでから書く
- 既存コードと矛盾するスタイルやパターンを導入しない

### 命名と構造
- 関数名・変数名・props名はその役割が明白な名前にする
- 1ファイルが肥大化したら責務ごとに分割する（目安: 200行超）
- ユーティリティ関数は純粋関数として切り出し、コンポーネントやストアに埋め込まない

### コメント
- 「なぜそうしているか」がコードから読み取れない箇所にのみコメントを書く（例: 座標変換の計算式、特定のワークアラウンドの理由）
- 「何をしているか」を説明するだけのコメントは書かない（コード自体が説明すべき）
- 設計書のセクション番号への参照は書かない（設計書は変更される可能性がある）

### 型安全性
- `as` キャストや `any` を使わない（biomeの `noExplicitAny: error` に従う）
- 配列アクセス時は `noUncheckedIndexedAccess` が有効なので、存在チェックを行う

### React / Konva
- Konvaのイベントハンドラは `useCallback` でメモ化し、依存配列を正確に指定する
- ストアのセレクタは必要なフィールドだけを取得し、不要な再レンダリングを避ける
- Konvaの背景画像などイベント不要なシェイプには `listening={false}` を設定する
